<main class="learning-path-container">
  <section class="home-grid">
    <section class="path-wrapper">
      <div class="path-content">
        @if (isLoading) {
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading courses...</p>
        </div>
        }

        @if (error) {
        <div class="error-state">
          <p>{{ error }}</p>
          <button class="btn-retry" (click)="loadCoursesFromApi()">Try Again</button>
        </div>
        }

        @if (!isLoading && !error && courses.length === 0) {
        <div class="empty-state">
          <p>No courses available yet.</p>
          <button class="btn-create" (click)="redirectToCreateExercise()">Create your first lesson</button>
        </div>
        }

        @if (!isLoading && !error && courses.length > 0) {
        <section class="units-container">
          @for (course of courses; track course.courseId; let i = $index) {

          <header class="unit-header" [style.--unit-color]="course.color">
            <h2 class="unit-title">{{ course.title }}</h2>
            <p class="unit-description">{{ course.description }}</p>
          </header>

          <section class="lessons-grid">
            @for (lesson of course.lessons; track lesson.lessonId) {
            <article [id]="'lesson-' + lesson.lessonId" class="lesson-node"
              [class.completed]="lesson.status === 'completed'" [class.in-progress]="lesson.status === 'in-progress'"
              [class.available]="lesson.status === 'available'" [class.locked]="lesson.status === 'locked'"
              [class.admin-override]="lesson.status === 'locked' && isAdmin"
              [class.current]="lesson.lessonId === currentLessonId" 
              (click)="onLessonClick(lesson)">
              <figure class="lesson-icon-wrapper">
                <!-- <span class="lesson-icon">{{ lesson.icon }}</span> -->

                @if (lesson.status === 'completed') {
                <span class="checkmark">‚úì</span>
                }

                @if (lesson.status === 'locked') {
                <div class="lock-overlay">
                  <span class="lock-icon">üîí</span>
                </div>
                }
              </figure>

              <div class="lesson-info">
                <h3 class="lesson-title">{{ lesson.title }}</h3>
                <p class="lesson-description">{{ lesson.description }}</p>

                @if (lesson.status !== 'locked' && lesson.totalPossibleXp) {
                <div class="lesson-progress">
                  <div class="progress-track">
                    <div class="progress-fill" [style.width.%]="(lesson.earnedXp ?? 0) / lesson.totalPossibleXp * 100"></div>
                  </div>
                  <span class="xp-label">{{ lesson.earnedXp ?? 0 }} / {{ lesson.totalPossibleXp }} XP</span>
                </div>
                }
              </div>

            </article>
            }
          </section>

          }
        </section>
        }
      </div>
    </section>

    <section class="sidebar">

      <header class="header-stats">

        <article class="stat-card">

          <figure class="stat-icon">üî•</figure>

          <div class="stat-content">

            <data [value]="currentStreak" class="stat-value">{{ currentStreak }}</data>

            <span class="stat-label">Daily streak</span>

          </div>

        </article>


        <article class="stat-card">

          <figure class="stat-icon">‚≠ê</figure>

          <div class="stat-content">

            <data [value]="totalXp" class="stat-value">{{ totalXp }}</data>

            <span class="stat-label">Total XP</span>

          </div>

        </article>

      </header>

      <section class="sidebar-buttons">
        <button class="jump-button" (click)="scrollToCurrentLesson()" aria-label="Jump to current lesson">
          @if (!isUserBelowLesson) {
            <span aria-hidden="true">‚Üì</span>
          } @else {
            <span aria-hidden="true">‚Üë</span>
          }
        </button>

        <button class="add-unit-button" (click)="redirectToCreateExercise()" aria-label="Add new unit">
          <span aria-hidden="true">+</span>
        </button>
      </section>
    </section>
  </section>
</main>